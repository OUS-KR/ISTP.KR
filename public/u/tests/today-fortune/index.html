<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ISTP</title>
    <link rel="stylesheet" href="/u/tests/assets/css/main.css?20251010120000">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ISTP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links"></nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ISTP 운세</h1>
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> ISTP 지수</div>
                <p id="mbtiIndexDisplay">ISTP 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
    </div>

    <script src="/u/tests/assets/js/main.js?20251010170000" defer></script>
    <script src="/u/tests/assets/js/dynamic-menu.js?20251010170000" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["논리적 사고가", "지적 호기심이", "독창적인 아이디어가", "체계적인 분석력이", "추상적인 통찰력이", "새로운 관점이"],
            verbs: ["빛을 발하는 날입니다.", "새로운 발견으로 이끌 것입니다.", "문제의 핵심을 꿰뚫어 봅니다.", "예상치 못한 기회를 가져다줍니다.", "당신을 한 단계 성장시킬 것입니다."],
            connectors: ["따라서", "그러니", "이 기회를 빌어", "망설이지 말고"],
            actions: ["한 걸음 물러서서 전체 시스템을 조망해 보세요.", "당신의 생각을 과감하게 실험에 옮겨보세요.", "평소와 다른 관점에서 문제를 바라보세요.", "다양한 분야의 지식을 융합하여 새로운 해결책을 찾아보세요.", "가장 근본적인 원리를 파고드는 시간을 가져보세요.", "당신의 아이디어를 구체적인 계획으로 발전시켜 보세요."]
        },
        task: {
            types: ["탐구하기:", "정리하기:", "설명하기:", "상상하기:"],
            actions: ["평소 궁금했던", "오랫동안 탐구하고 싶었던", "최근 흥미가 생긴", "당연하게 여겼던"],
            subjects: ["과학적 원리", "철학적 개념", "복잡한 시스템", "사회적 현상", "미해결 문제", "역사적 사건"],
            verbs: ["에 대해 15분간 깊이 파고들어 보세요.", "의 핵심을 한 문장으로 요약해 보세요.", "을(를) 비전문가도 이해할 수 있도록 설명하는 글을 써보세요.", "과/와 관련된 새로운 아이디어를 3가지 이상 기록해 보세요.", "의 작동 방식을 다이어그램으로 그려보세요."]
        },
        mbtiIndex: {
            reasons: ["논리 회로가 명료하게 작동하여", "창의적 영감이 샘솟아", "지적 탐구심이 최고조에 달해", "시스템 전체를 꿰뚫어보는 통찰력이 발휘되어", "복잡한 정보 속에서 패턴을 발견하여"],
            results: ["분석적 사고력이 극대화됩니다.", "새로운 아이디어를 현실화할 가능성이 높습니다.", "복잡한 문제도 쉽게 해결할 수 있습니다.", "지적인 만족감을 크게 느낄 수 있습니다."]
        },
        keywords: ["논리", "분석", "시스템", "통찰", "혁신", "아이디어", "탐구", "지식", "독립", "패턴", "융합", "추상화", "전략", "효율", "원리", "개념", "가설", "검증", "모델링", "알고리즘"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateMbtiIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('mbtiIndexDisplay').innerText = generateMbtiIndex(randFn, data.mbtiIndex);
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        } catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>