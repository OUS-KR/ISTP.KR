<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ISTP</title>
    <link rel="stylesheet" href="/u/tests/assets/css/main.css?20251010120000">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4262871645049971" crossorigin="anonymous"></script>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ISTP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links"></nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ISTP 운세</h1>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="2065367733"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> ISTP 지수</div>
                <p id="mbtiIndexDisplay">ISTP 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-format="autorelaxed"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="5813041058"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div id="giscus-container" style="margin: 15px 0;"></div>
        <script>
            function loadGiscus() {
                const container = document.getElementById('giscus-container');
                while (container.firstChild) container.removeChild(container.firstChild);
                
                const script = document.createElement('script');
                script.src = 'https://giscus.app/client.js';
                script.setAttribute('data-repo', 'OUS-KR/INTP.KR');
                script.setAttribute('data-repo-id', 'R_kgDOOrfScQ');
                script.setAttribute('data-category', 'Announcements');
                script.setAttribute('data-category-id', 'DIC_kwDOOrfScc4CqQAN');
                script.setAttribute('data-mapping', 'pathname');
                script.setAttribute('data-strict', '0');
                script.setAttribute('data-reactions-enabled', '1');
                script.setAttribute('data-emit-metadata', '1');
                script.setAttribute('data-input-position', 'top');
                script.setAttribute('data-theme', localStorage.getItem('theme') ?? 'light');
                script.setAttribute('data-loading', 'lazy');
                script.setAttribute('data-lang', 'ko');
                script.setAttribute('crossorigin', 'anonymous');
                script.setAttribute('async', '');
                
                container.appendChild(script);
            }
            
            loadGiscus();
        </script>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-format="autorelaxed"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="5813041058"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>

    <script src="/u/tests/assets/js/main.js?20251020100400" defer></script>
    <script src="/u/tests/assets/js/dynamic-menu.js?20251010170000" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts (ISTP) ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["당신의 뛰어난 문제 해결 능력이", "상황을 꿰뚫어 보는 날카로운 관찰력이", "도구를 능숙하게 다루는 손재주가", "위기 상황에서도 침착함을 잃지 않는 냉철함이", "효율성을 추구하는 실용적인 태도가"],
            verbs: ["복잡하게 얽힌 매듭을 단번에 풀어냅니다.", "다른 사람들이 놓치는 핵심을 발견하게 합니다.", "상상 속의 아이디어를 현실로 만들어냅니다.", "주변 사람들에게 강한 신뢰감을 줍니다.", "불필요한 낭비를 막고 최적의 결과를 도출합니다."],
            connectors: ["그러니", "이 기회를 활용해", "자신감을 갖고", "망설이지 말고"],
            actions: ["오랫동안 해결하지 못한 문제를 다른 각도에서 분석해 보세요.", "흥미로운 기계나 도구의 작동 원리를 탐구해 보세요.", "혼자만의 시간을 가지며 새로운 기술을 연마해 보세요.", "즉흥적으로 떠오른 아이디어를 바로 실행에 옮겨보세요.", "가끔은 당신의 지식과 기술을 다른 사람과 공유해 보세요."]
        },
        task: {
            types: ["분해하기:", "만들기:", "탐험하기:", "해결하기:"],
            actions: ["더 이상 쓰지 않는", "주변의 재료들을 활용하여", "한 번도 가보지 않은", "일상에서 가장 불편했던"],
            subjects: ["작은 기계", "새로운 도구", "동네의 뒷골목", "작은 문제"],
            verbs: ["의 작동 원리를 분석해 보세요.", "를 즉흥적으로 만들어 보세요.", "을(를) 탐험하며 새로운 경로를 개척해 보세요.", "를 당신만의 방식으로 해결해 보세요."]
        },
        mbtiIndex: {
            reasons: ["날카로운 분석력이 시스템의 허점을 발견하여", "뛰어난 손재주가 빛을 발하여", "예상치 못한 위기 상황에서 침착함이 유지되어", "효율성을 극대화하는 해결책을 찾아내어"],
            results: ["아무도 풀지 못한 문제를 해결할 수 있습니다.", "복잡한 도구나 기계도 능숙하게 다룰 수 있습니다.", "오히려 위기를 즐기며 뛰어난 능력을 발휘합니다.", "최소한의 노력으로 최대의 효과를 얻게 됩니다."]
        },
        keywords: ["현실적인", "실용적인", "독립적인", "논리적인", "분석적인", "유연한", "즉흥적인", "과묵한", "절제된", "호기심 많은", "행동 지향적", "문제 해결사", "장인", "스파르타쿠스", "적응력", "관찰력", "손재주", "위기 대처", "효율성", "냉철함", "자율성"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateMbtiIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('mbtiIndexDisplay').innerText = generateMbtiIndex(randFn, data.mbtiIndex);
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        } catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>