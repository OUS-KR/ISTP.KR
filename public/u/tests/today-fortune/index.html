<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ISTP</title>
    <link rel="stylesheet" href="/u/tests/assets/css/main.css?20251010120000">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ISTP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links"></nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ISTP 운세</h1>
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> ISTP 지수</div>
                <p id="mbtiIndexDisplay">ISTP 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
    </div>

    <script src="/u/tests/assets/js/main.js?20251010170000" defer></script>
    <script src="/u/tests/assets/js/dynamic-menu.js?20251010170000" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["뛰어난 손재주가", "날카로운 관찰력이", "현실적인 문제 해결 능력이", "유연한 사고방식이", "독립적인 정신이", "침착한 위기 대처 능력이"],
            verbs: ["빛을 발하는 날입니다.", "새로운 기술을 습득할 것입니다.", "문제를 효율적으로 해결할 것입니다.", "예상치 못한 기회를 가져다줍니다.", "당신을 더욱 성장시킬 것입니다."],
            connectors: ["따라서", "그러니", "이 기회를 빌어", "망설이지 말고"],
            actions: ["자신의 감정을 솔직하게 표현하는 연습을 해보세요.", "장기적인 목표를 위한 구체적인 계획을 세워보세요.", "타인의 감정에 공감하고 소통하는 노력을 해보세요.", "충동적인 행동을 조절하고 신중하게 판단해 보세요.", "자신만의 시간을 존중하되 주변과도 교류해 보세요.", "비효율적인 것을 개선하기 위한 아이디어를 적용해 보세요."]
        },
        task: {
            types: ["만들기:", "해결하기:", "탐험하기:", "배우기:"],
            actions: ["오랫동안 미뤄왔던", "복잡하게 얽힌", "새로운 기술이 필요한", "직접 경험해보고 싶은"],
            subjects: ["기계 장치", "고장 난 물건", "새로운 취미", "미지의 장소", "복잡한 퍼즐", "실용적인 기술"],
            verbs: ["을(를) 직접 만들어 보세요.", "을(를) 효율적으로 해결해 보세요.", "을(를) 탐험하며 새로운 것을 발견해 보세요.", "을(를) 통해 새로운 기술을 배워보세요.", "의 작동 원리를 파고들어 보세요."]
        },
        mbtiIndex: {
            reasons: ["뛰어난 손재주와 문제 해결 능력이 발휘되어", "현실적이고 실용적인 접근 방식으로 문제를 해결하여", "유연하고 적응력 있는 태도로 새로운 상황에 대처하여", "독립적인 사고와 행동으로 자신만의 길을 개척하여", "침착하고 냉정한 판단력으로 위기를 극복하여"],
            results: ["새로운 기술을 습득하고 능력을 향상시킬 수 있습니다.", "어떤 문제든 효율적으로 해결할 수 있는 힘을 얻습니다.", "자유롭고 독립적인 삶을 만끽할 수 있습니다.", "실질적인 성과를 통해 만족감을 느낄 수 있습니다."]
        },
        keywords: ["간단명료", "개인주의", "객관적", "결단력", "과묵함", "기브앤테이크", "낙천적", "논리적", "노력", "절약", "담력", "독립성", "무관심", "모험", "사실주의", "생산성", "생활력", "실용적", "욜로", "우선순위"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateMbtiIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('mbtiIndexDisplay').innerText = generateMbtiIndex(randFn, data.mbtiIndex);
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        }
        catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>